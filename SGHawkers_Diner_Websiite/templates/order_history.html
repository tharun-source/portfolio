{% extends "base.html" %}

{% block title %}Order History{% endblock %}

{% block content %}
<h2 class="order-history-title">Your Order History</h2>

{% if orders %}
    <div class="content">
        {% for order in orders %}
        <div class="order-card">
            <h3>Order #{{ order['order_id'] }}</h3>

            <p><strong>Date:</strong> {{ order['date'] }}</p>
            <p><strong>Order Type:</strong> {{ order['order_type'] }}</p>
             {% if 'items' in order and order['items'] is iterable %}
        <ul>
            {% for item in order['items'] %}
                <li>{{ item['name'] }} - ${{ item['price'] }}</li>
            {% endfor %}
        </ul>
    {% else %}
        <p><strong>⚠️ Error:</strong> Order items are not in the expected format.</p>
    {% endif %}

            {% if order['order_type'] == "Delivery" %}
                <p><strong>Delivery Time:</strong> {{ order['delivery_time'] }}</p>
                <p><strong>Delivery Address:</strong> {{ order['address'] if order['address'] else "No address provided" }}</p>
            {% else %}
                <p><strong>Pickup Time:</strong> {{ order['delivery_time'] }}</p>
            {% endif %}

            <p><strong>Personal Request:</strong> {{ order['personal_request'] if order['personal_request'] else "None" }}</p>
            <ul class="order-items">
                {% for item in order['items'] %}
                <li>{{ item['name'] }} <span>${{ "%.2f"|format(item['price']) }}</span></li>
                {% endfor %}
            </ul>
            <p class="total-price">Total: ${{ "%.2f"|format(order['total_price']) if 'total_price' in order else "0.00" }}</p>


        </div>
        {% endfor %}
    </div>
{% else %}
    <p class="no-orders">No past orders found.</p>
{% endif %}

<script>
    function cancelOrder(orderId) {
        if (!confirm("Are you sure you want to cancel this order?")) return;

        fetch(/cancel_order/${orderId}, {
            method: "POST",
            headers: { "Content-Type": "application/json" }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Order has been cancelled successfully.");
                document.getElementById(status-${orderId}).innerText = "Cancelled";
                document.getElementById(order-${orderId}).style.opacity = "0.5";  // Dim cancelled orders
            } else {
                alert("Failed to cancel the order: " + data.message);
            }
        })
        .catch(error => console.error("Error cancelling order:", error));
    }
</script>



<style>
/* General Page Styling */
body {
    font-family: Arial, sans-serif;
    background-color: #f8f9fa; /* Light gray background */
    margin: 0;
    padding: 0;
}

/* Center Content */
.content {
    margin-left: 220px; /* Space for the sidebar */
    padding: 20px;
    max-width: 800px;
    margin: 0 auto; /* Center the content horizontally */
}

/* Order History Title */
.order-history-title {
    font-size: 28px;
    margin-bottom: 20px;
    color: #333; /* Dark gray */
    text-align: center; /* Center-align title */
}

/* Order Card Styling */
.order-card {
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1); /* Subtle shadow */
}
 .cancel-order-btn {
        background-color: red;
        color: white;
        border: none;
        padding: 10px;
        cursor: pointer;
        border-radius: 5px;
    }
    .cancel-order-btn:hover {
        background-color: darkred;
    }


/* Order Details Styling */
.order-card h3 {
    font-size: 20px;
    color: #007bff; /* Blue for order number */
    margin-bottom: 10px;
}

.order-card p {
    margin: 5px 0;
    color: #555; /* Medium gray text */
}

/* Remove Bullet Points from Item List */
.order-items {
    list-style-type: none; /* Remove default bullets */
    padding: 0;
    margin: 10px 0;
    border-top: 1px solid #ddd;
    padding-top: 10px;
}

.order-items li {
    padding: 5px 0;
    font-size: 16px;
    color: #333; /* Darker text for items */
}

.order-items li span {
    float: right; /* Align price to the right */
    color: #28a745; /* Green for prices */
    font-weight: bold;
}

/* Total Price Styling */
.total-price {
    font-size: 18px;
    font-weight: bold;
    color: #000; /* Black for emphasis */
    margin-top: 10px;
}

/* Empty Order Styling */
.no-orders {
    font-size: 18px;
    text-align: center; /* Center-align the message */
    color: #888; /* Light gray */
}

/* Responsive Design */
@media (max-width: 768px) {
    .content {
        margin-left: 0;
        padding: 10px;
    }

    .order-card {
        font-size: 14px;
    }
}


</style>

{% endblock %}
